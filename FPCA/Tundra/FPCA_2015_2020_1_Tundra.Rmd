---
title: "Analysing the effects of climate change and forest disturbance on vegetation dynamics in the boreal forest"
author: "Theresa Meier, 25.04.2024"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

***

## Exploratory Analysis: FPCA for PFT *Tundra* with disturbances between 2015 and 2020

***
Patches which face a disturbance between the years **2015** and **2020** are the basis for this analysis. As a first step in the exploratory analysis, the data is represented as functions by means of a b-spline basis. Several versions of order and penalized derivatives were analyzed, including the following setups:

- Order 6 is chosen, because fits for lower orders were nearly linear and higher orders became too complex.
- Penalization up to the forth derivative of the smoothed fit was evaluated. Figure 1 and Figure 2 show the fits for *Tundra* for penalizing the third and forth derivative, respectively. For lower derivatives, the fit is again nearly constant.

Note that no linear differential operator was constructed so far. This could be a mean to improve the fit even further.
The following analysis is conducted with penalizing the forth derivative. The results for penalizing the third derivative are pretty similar, with only the starting years changing. The PC scores however are nearly the same as for penalizing the forth derivative, so the final interpretation is hardly affected.

### Basis Representation - Tundra
![**Figure 1:** Smoothed basis representation for Tundra and all four scenarios. Here, the thrid derivative of the 6-order-splines is penalized. ](/home/theresa/Schreibtisch/Theresa/STUDIUM/Master Statistics and Data Science/Masterarbeit/Scripts/Plots/FPCA/PCs_2015_2020/PCA_Tundra_1_nderiv3.png)

![**Figure 2:**  Smoothed basis representation for Tundra and all four scenarios. Here, the forth derivative of the 6-order-splines is penalized.  ](/home/theresa/Schreibtisch/Theresa/STUDIUM/Master Statistics and Data Science/Masterarbeit/Scripts/Plots/FPCA/PCs_2015_2020/PCA_Tundra_1.png)

***

As a second step, data registration is considered. Unfortunately, the function `landmarkreg` (package `fda`) is not available, so no landmark registration is possible without self implementation. Thus, the curves are being registered with function `register.fd` which is not based on landmarks but on aligning with the mean function. As stated by Ramsay et al. (2009), this type of registration should usually be conducted after landmark registration. Figure 3 shows the registered curves for *Tundra*.

![**Figure 3:**  Smoothed basis representation for Tundra and all four scenarios with registration  ](/home/theresa/Schreibtisch/Theresa/STUDIUM/Master Statistics and Data Science/Masterarbeit/Scripts/Plots/FPCA/PCs_2015_2020/PCA_Tundra_1_registered.png)
Obviously, we can see ...


***

### Principal Component Analysis - Tundra
To further analyze the data, a FPCA is run for each of the four scenarios and each of the five PFTs separately. Again, let's take a look at the two principal components for each scenario of PFT *Tundra*. Figure 4 shows the unregistered principal components.

![](/home/theresa/Schreibtisch/Theresa/STUDIUM/Master Statistics and Data Science/Masterarbeit/Scripts/Plots/FPCA/PCs_2015_2020/unrotated/Tundra/PCA_control_126_Tundra_1_unrotated.png)
![**Figure 4:**  First two principal components for each scenario for PFT *Tundra* ](/home/theresa/Schreibtisch/Theresa/STUDIUM/Master Statistics and Data Science/Masterarbeit/Scripts/Plots/FPCA/PCs_2015_2020/unrotated/Tundra/PCA_370_585_Tundra_1_unrotated.png)

The first principal component reflects a higher or lower peak in the share of aboveground carbon.

*** 

#### With registration

Figure 5 shows the two principal components for each scenario for the registered curves.

![](/home/theresa/Schreibtisch/Theresa/STUDIUM/Master Statistics and Data Science/Masterarbeit/Scripts/Plots/FPCA/PCs_2015_2020/registered/Tundra/PCA_control_126_Tundra_1_registered.png)
![**Figure 5:**  First two principal components for each scenario for PFT *Tundra* for registered B-spline respresentation. ](/home/theresa/Schreibtisch/Theresa/STUDIUM/Master Statistics and Data Science/Masterarbeit/Scripts/Plots/FPCA/PCs_2015_2020/registered/Tundra/PCA_370_585_Tundra_1_registered.png)

We can see that the effects are less pronounced than in the unregistered case, which is not surprising since the registration process removes some of the variability in the data. 

***

#### With VARIMAX rotation

For a better understanding and an easier interpretation of the principal components, a VARIMAX rotation is applied.

Figure 6 shows the VARIMAX rotated first and second principal components for each scenario.


![](/home/theresa/Schreibtisch/Theresa/STUDIUM/Master Statistics and Data Science/Masterarbeit/Scripts/Plots/FPCA/PCs_2015_2020/varimax/Tundra/PCA_control_126_Tundra_1_varimax.png)
![**Figure 6:**  First two principal components for each scenario for PFT *Tundra* with VARIMAX rotation. ](/home/theresa/Schreibtisch/Theresa/STUDIUM/Master Statistics and Data Science/Masterarbeit/Scripts/Plots/FPCA/PCs_2015_2020/varimax/Tundra/PCA_370_585_Tundra_1_varimax.png)


***

### Cluster detection: PC1 vs. PC2 - Tundra


![**Figure 7:**  First principal component vs. second principal component for each scenario for PFT *Tundra*. ](/home/theresa/Schreibtisch/Theresa/STUDIUM/Master Statistics and Data Science/Masterarbeit/Scripts/Plots/FPCA/PCs_2015_2020/unrotated/Tundra/PC1_vs_PC2_Tundra_1_unrotated.png)

![**Figure 8:**   First registered principal component vs. second registered principal component for each scenario for PFT *Tundra*. ](/home/theresa/Schreibtisch/Theresa/STUDIUM/Master Statistics and Data Science/Masterarbeit/Scripts/Plots/FPCA/PCs_2015_2020/registered/Tundra/PC1_vs_PC2_Tundra_1_registered.png)

![**Figure 9:**  First VARIMAX rotated component vs. second VARIMAX rotated component for each scenario for PFT *Tundra* ](/home/theresa/Schreibtisch/Theresa/STUDIUM/Master Statistics and Data Science/Masterarbeit/Scripts/Plots/FPCA/PCs_2015_2020/varimax/Tundra/PC1_vs_PC2_Tundra_1_varimax.png)