---
title: "Analysing the effects of climate change and forest disturbance on vegetation dynamics in the boreal forest"
author: "Theresa Meier, 25.04.2024"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

***

## Exploratory Analysis: FPCA for PFT *Needleleaf Evergreen* with disturbances between 2015 and 2040

***
Patches which face a disturbance between the years **2015** and **2040** are the basis for this analysis. As a first step in the exploratory analysis, the data is represented as functions by means of a b-spline basis equivalently as for PFT *Tundra*, i.e. b-splines of order 6, penalizing the third derivative with a penalization parameter $\lambda = 1$.

### Basis Representation - Needleleaf Evergreen

Figure 1 shows the chosen basis representation for *Needleleaf Evergreen*.

![**Figure 1:**  Smoothed basis representation for PFT Needleleaf Evergreen and all four scenarios.  ](/home/theresa/Schreibtisch/Theresa/STUDIUM/Master Statistics and Data Science/Masterarbeit/Scripts/Plots/FPCA/PCs_2015_2040/PCA_BNE_1.png)

***


<!-- As a second step, data registration is considered. Unfortunately, the function `landmarkreg` (package `fda`) is not available, so no landmark registration is possible without self implementation. Thus, the curves are being registered with function `register.fd` which is not based on landmarks but on aligning with the mean function. As stated by Ramsay et al. (2009), this type of registration should usually be conducted after landmark registration. Figure 2 shows the registered curves for *Needleleaf Evergreen*. -->

<!-- ![**Figure 2:**  Smoothed basis representation for Needleleaf Evergreen and all four scenarios with registration  ](/home/theresa/Schreibtisch/Theresa/STUDIUM/Master Statistics and Data Science/Masterarbeit/Scripts/Plots/FPCA/PCs_2015_2040/PCA_BNE_1_registered.png) -->

<!-- *** -->

<!-- Interestingly, in the climate scenarios, we can observe some weird behavior. For *Tundra* this was the case for the control scenario only. -->

<!-- *** -->

### Principal Component Analysis - Needleleaf Evergreen
To further analyze the data, a FPCA is run for each of the four scenarios and each of the five PFTs separately. Again, let's take a look at the two principal components for each scenario of PFT *Needleleaf Evergreen*. Figure 2 shows the principal components.

![](/home/theresa/Schreibtisch/Theresa/STUDIUM/Master Statistics and Data Science/Masterarbeit/Scripts/Plots/FPCA/PCs_2015_2040/unrotated/BNE/PCA_control_126_BNE_1_unrotated.png)

![**Figure 2:**  First two principal components for each scenario for PFT *Needleleaf Evergreen* ](/home/theresa/Schreibtisch/Theresa/STUDIUM/Master Statistics and Data Science/Masterarbeit/Scripts/Plots/FPCA/PCs_2015_2040/unrotated/BNE/PCA_370_585_BNE_1_unrotated.png)

***

For Tundra, we could see huge differences between the Control scenario and the climate scenario. Here however, the principal components for all four scenarios are pretty similar and all reflect the same patterns: high values in the first PC stand for much higher values of above ground carbon than the mean after the 10 first years of the considered time span and vice versa for low values. The second principal component mainly reflects peaks in the last third of the study period.

*** 

<!-- #### With registration -->

<!-- Figure 4 shows the two principal components for each scenario for the registered curves. -->

<!-- ![](/home/theresa/Schreibtisch/Theresa/STUDIUM/Master Statistics and Data Science/Masterarbeit/Scripts/Plots/FPCA/PCs_2015_2040/registered/BNE/PCA_control_126_BNE_1_registered.png) -->

<!-- ![**Figure 4:**  First two principal components for each scenario for PFT *Needleleaf Evergreen* for registered B-spline respresentation. ](/home/theresa/Schreibtisch/Theresa/STUDIUM/Master Statistics and Data Science/Masterarbeit/Scripts/Plots/FPCA/PCs_2015_2040/registered/BNE/PCA_370_585_BNE_1_registered.png) -->

<!-- *** -->

<!-- The first principal component is hardly affected by the registration, whereas the second principal component is now driven by two cutting points, which change the interpretation completely. -->

<!-- *** -->

#### With VARIMAX rotation

For a better understanding and an easier interpretation of the principal components, a VARIMAX rotation is applied. This rotation algorithm may reveal more meaningful components of variation in the data (Ramsay et al. (2009)).

Figure 3 shows the VARIMAX rotated first and second principal components for each scenario.

![](/home/theresa/Schreibtisch/Theresa/STUDIUM/Master Statistics and Data Science/Masterarbeit/Scripts/Plots/FPCA/PCs_2015_2040/varimax/BNE/PCA_control_126_BNE_1_varimax.png)

![**Figure 3:**  First two principal components for each scenario for PFT *Needleleaf Evergreen* with VARIMAX rotation. ](/home/theresa/Schreibtisch/Theresa/STUDIUM/Master Statistics and Data Science/Masterarbeit/Scripts/Plots/FPCA/PCs_2015_2040/varimax/BNE/PCA_370_585_BNE_1_varimax.png)


***

In this case, the VARIMAX rotation does not substantially increase the interpretability, since the first two principal components are hardly changed. Thus, a rotation might be unnecessary.


***

### Cluster detection: PC1 vs. PC2 - Needleleaf Evergreen

In order to detect possible clusters in the data, i.e. the share of above ground carbon may behave in similar ways for several grid points, the two first principal components are plotted against each other for all considered cases: unrotated (Figure 4) and VARIMAX rotated (Figure 5). The color reflects a rough classifying into regions, here continents.

![**Figure 4:**  First principal component vs. second principal component for each scenario for PFT *Needleleaf Evergreen*. ](/home/theresa/Schreibtisch/Theresa/STUDIUM/Master Statistics and Data Science/Masterarbeit/Scripts/Plots/FPCA/PCs_2015_2040/unrotated/BNE/PC1_vs_PC2_BNE_1_unrotated.png)

***

In Figure 4, a light clustering pattern is visible, especially for the more drastic scenarios. The three warming scenarios tend to follow a similar pattern. For the control scenario, the data is more scattered.

<!-- *** -->
<!-- ![**Figure 7:**   First registered principal component vs. second registered principal component for each scenario for PFT *Needleleaf Evergreen*. ](/home/theresa/Schreibtisch/Theresa/STUDIUM/Master Statistics and Data Science/Masterarbeit/Scripts/Plots/FPCA/PCs_2015_2040/registered/BNE/PC1_vs_PC2_BNE_1_registered.png) -->

<!-- *** -->

<!-- For *Needleleaf Evergreen*, the registration does not lead to a substantial difference in PC scores. This was already indicated in Figure 4 as the first PC hardly change in comparison to the unregistered one. -->

***

![**Figure 5:**  First VARIMAX rotated component vs. second VARIMAX rotated component for each scenario for PFT *Needleleaf Evergreen* ](/home/theresa/Schreibtisch/Theresa/STUDIUM/Master Statistics and Data Science/Masterarbeit/Scripts/Plots/FPCA/PCs_2015_2040/varimax/BNE/PC1_vs_PC2_BNE_1_varimax.png)

***

Rotation does not lead to a substantial difference in PC scores for *Needleleaf Evergreen*. This was already indicated in Figure 3 as the PCs hardly change in comparison to the unrotated ones.


## Spatial Distribution visualized in world maps

In order to get a better understanding of the spatial component of the data, Figure 6 shows how the portion of above ground carbon from year 0 to 100 after disturbance develop in each grid cell (patch 1). 

![**Figure 6:** Spatial distribution of the portion of above ground carbon after distrubance for each scenario for PFT *Needleleaf Evergreen*. ](/home/theresa/Schreibtisch/Theresa/STUDIUM/Master Statistics and Data Science/Masterarbeit/Scripts/Plots/FPCA/Maps/gif_BNE.gif)


***

We can clearly see major differences between the scenarios and the considered regions. The more drastic the warming scenario, the less Needleleaf Evergreen is present. This pattern is possibly due to a higher share of temperate broadleaf in warmer scenarios.