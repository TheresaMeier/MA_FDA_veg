---
title: "Analysing the effects of climate change and forest disturbance on vegetation dynamics in the boreal forest"
author: "Theresa Meier, 25.04.2024"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

***

## Exploratory Analysis: FPCA for PFT *Temperate Broadleaf* with disturbances between 2015 and 2040

***
Patches which face a disturbance between the years **2015** and **2040** are the basis for this analysis. As a first step in the exploratory analysis, the data is represented as functions by means of a b-spline basis equivalently as for PFT *Tundra*, i.e. b-splines of order 6, penalizing the third derivative with a penalization parameter $\lambda = 1$.

### Basis Representation - Temperate Broadleaf

Figure 1 shows the chosen basis representation for *Temperate Broadleaf*.

![**Figure 1:**  Smoothed basis representation for PFT Temperate Broadleaf and all four scenarios.  ](/home/theresa/Schreibtisch/Theresa/STUDIUM/Master Statistics and Data Science/Masterarbeit/Scripts/Plots/FPCA/PCs_2015_2040/PCA_TeBS_1.png)

***

Note that there is less data available as for the other PFTs because in a lot of grid cells, the share of temperate broadleaf is constantly zero. This is not surprising in the boreal forest, since it is usally dominated by needleleaf.

<!-- As a second step, data registration is considered. Unfortunately, the function `landmarkreg` (package `fda`) is not available, so no landmark registration is possible without self implementation. Thus, the curves are being registered with function `register.fd` which is not based on landmarks but on aligning with the mean function. As stated by Ramsay et al. (2009), this type of registration should usually be conducted after landmark registration. Figure 2 shows the registered curves for *Temperate Broadleaf*. -->

<!-- ![**Figure 2:**  Smoothed basis representation for Temperate Broadleaf and all four scenarios with registration  ](/home/theresa/Schreibtisch/Theresa/STUDIUM/Master Statistics and Data Science/Masterarbeit/Scripts/Plots/FPCA/PCs_2015_2040/PCA_TeBS_1_registered.png) -->

<!-- *** -->

<!-- We can see that the registration leads to a more aligned fit. -->

***

### Principal Component Analysis - Temperate Broadleaf
To further analyze the data, a FPCA is run for each of the four scenarios and each of the five PFTs separately. Again, let's take a look at the two principal components for each scenario of PFT *Temperate Broadleaf*. Figure 2 shows the principal components.

![](/home/theresa/Schreibtisch/Theresa/STUDIUM/Master Statistics and Data Science/Masterarbeit/Scripts/Plots/FPCA/PCs_2015_2040/unrotated/TeBS/PCA_control_126_TeBS_1_unrotated.png)

![**Figure 2:**  First two principal components for each scenario for PFT *Temperate Broadleaf* ](/home/theresa/Schreibtisch/Theresa/STUDIUM/Master Statistics and Data Science/Masterarbeit/Scripts/Plots/FPCA/PCs_2015_2040/unrotated/TeBS/PCA_370_585_TeBS_1_unrotated.png)

***

For Tundra, we could see huge differences between the Control scenario and the climate scenario. Here however, the first principal components for all four scenarios are pretty similar and all reflect the same patterns: high values in the first PC stand for much higher values of above ground carbon than the mean and vice versa for low values. The second principal component mainly reflects lower values as the mean for higher PC2 scores until a break point and then higher values than the mean, vice versa for lower values of PC2. Note that the time point of the change differs among the scenarios and that this effect is reversed for the SSP1-RCP2.6 scenario (why?)! 

*** 

<!-- #### With registration -->

<!-- Figure 4 shows the two principal components for each scenario for the registered curves. -->

<!-- ![](/home/theresa/Schreibtisch/Theresa/STUDIUM/Master Statistics and Data Science/Masterarbeit/Scripts/Plots/FPCA/PCs_2015_2040/registered/TeBS/PCA_control_126_TeBS_1_registered.png) -->

<!-- ![**Figure 4:**  First two principal components for each scenario for PFT *Temperate Broadleaf* for registered B-spline respresentation. ](/home/theresa/Schreibtisch/Theresa/STUDIUM/Master Statistics and Data Science/Masterarbeit/Scripts/Plots/FPCA/PCs_2015_2040/registered/TeBS/PCA_370_585_TeBS_1_registered.png) -->

<!-- *** -->

<!-- The first principal component is hardly affected by the registration. The second principal component is now driven by two cutting points, which change the interpretation completely. A similar pattern is present in the PFT *Needleleaf Evergreen*, *Pioneering Needleleaf* and *Other Conifers*. Note that now, the positive and negative effects are all the same for all four scenarios, i.e. the signs have changed for SSP1-RCP2.6. -->

<!-- *** -->

#### With VARIMAX rotation

For a better understanding and an easier interpretation of the principal components, a VARIMAX rotation is applied. This rotation algorithm may reveal more meaningful components of variation in the data (Ramsay et al. (2009)).

Figure 3 shows the VARIMAX rotated first and second principal components for each scenario.

![](/home/theresa/Schreibtisch/Theresa/STUDIUM/Master Statistics and Data Science/Masterarbeit/Scripts/Plots/FPCA/PCs_2015_2040/varimax/TeBS/PCA_control_126_TeBS_1_varimax.png)

![**Figure 3:**  First two principal components for each scenario for PFT *Temperate Broadleaf* with VARIMAX rotation. ](/home/theresa/Schreibtisch/Theresa/STUDIUM/Master Statistics and Data Science/Masterarbeit/Scripts/Plots/FPCA/PCs_2015_2040/varimax/TeBS/PCA_370_585_TeBS_1_varimax.png)


***

Here, an interesting development is present: for the control, SSP3-RSP7.0 and SSP5-RSP8.5 scenario the first component nearly stays unchanged with only small changes at the end of the time span. For the SSP1-RSP2.6 scenarios however, the first principal component reflects now a rather mean fit until the year 2080 and then higher values for above mean shares of carbon. For the second principal component, the effects are differently pronounced but keep the signs.

***

### Cluster detection: PC1 vs. PC2 - Temperate Broadleaf

In order to detect possible clusters in the data, i.e. the share of above ground carbon may behave in similar ways for several grid points, the two first principal components are plotted against each other for all considered cases: unrotated and VARIMAX rotated (Figure 5). The color reflects a rough classifying into regions, here continents.

![**Figure 4:**  First principal component vs. second principal component for each scenario for PFT *Temperate Broadleaf*. ](/home/theresa/Schreibtisch/Theresa/STUDIUM/Master Statistics and Data Science/Masterarbeit/Scripts/Plots/FPCA/PCs_2015_2040/unrotated/TeBS/PC1_vs_PC2_TeBS_1_unrotated.png)

***

In Figure 4, no clustering pattern is visible at all. The scores are rather scattered and do not show clear signs of grouping. However, some similarities are present between the climate scenarios.

<!-- *** -->
<!-- ![**Figure 7:**   First registered principal component vs. second registered principal component for each scenario for PFT *Temperate Broadleaf*. ](/home/theresa/Schreibtisch/Theresa/STUDIUM/Master Statistics and Data Science/Masterarbeit/Scripts/Plots/FPCA/PCs_2015_2040/registered/TeBS/PC1_vs_PC2_TeBS_1_registered.png) -->

<!-- *** -->

<!-- Although, the registration introduces some sort of structure for *Temperate Broadleaf*, the registration has no effect in terms of cluster formation. -->

***

![**Figure 5:**  First VARIMAX rotated component vs. second VARIMAX rotated component for each scenario for PFT *Temperate Broadleaf* ](/home/theresa/Schreibtisch/Theresa/STUDIUM/Master Statistics and Data Science/Masterarbeit/Scripts/Plots/FPCA/PCs_2015_2040/varimax/TeBS/PC1_vs_PC2_TeBS_1_varimax.png)

***

Rotation does not lead to a substantial difference in PC scores for *Temperate Broadleaf*. This was already indicated in Figure 3 as the PCs hardly change in comparison to the unrotated ones.

## Spatial Distribution visualized in world maps

In order to get a better understanding of the spatial component of the data, Figure 6 shows how the portion of above ground carbon from year 0 to 100 after disturbance develop in each grid cell (patch 1). 

![**Figure 6:** Spatial distribution of the portion of above ground carbon after distrubance for each scenario for PFT *Temperate Broadleaf*. ](/home/theresa/Schreibtisch/Theresa/STUDIUM/Master Statistics and Data Science/Masterarbeit/Scripts/Plots/FPCA/Maps/gif_TeBS.gif)


***

We can clearly see major differences between the scenarios and the considered regions. The more drastic the warming scenario, the more temperate broadleaf is present. This pattern is possibly due to a smaller share of needleleaf evergreen in warmer scenarios.

